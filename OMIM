import openai_secret_manager
import openai
import requests

# Authenticate with OpenAI API
secrets = openai_secret_manager.get_secret("openai")
openai.api_key = secrets["api_key"]

# Authenticate with OMIM API
secrets = openai_secret_manager.get_secret("omim")
omim_api_key = secrets["api_key"]

# Prompt user for gene name
gene_name = input("Please enter a gene name: ")

# Use GPT-3 to correct spelling of gene name
model_engine = "text-davinci-002"
response = openai.Completion.create(
    engine=model_engine,
    prompt=f"I think the gene name you meant was {gene_name}.",
    max_tokens=50,
    n=1,
    stop=None,
    temperature=0.7,
)

corrected_gene_name = response.choices[0].text.strip()

# Use OMIM API to get gene description
url = f"https://api.omim.org/api/geneMap/search?search={corrected_gene_name}&format=json&apiKey={omim_api_key}"
response = requests.get(url).json()

if "geneMapList" in response and response["geneMapList"]:
    gene_description = response["geneMapList"][0]["geneMap"]["description"]
    print(f"Description of {corrected_gene_name}: {gene_description}")
else:
    print(f"No gene description found for {corrected_gene_name}")
